<tui-root>
    <h1>Корзина</h1>
    <tui-stepper [(activeItemIndex)]="currentStep">
        <button tuiStep stepState="pass">Состав заказа</button>
        <button tuiStep>Оформление заказа</button>
        <button tuiStep>Подтверждение заказа</button>
    </tui-stepper>

    <div [ngSwitch]="currentStep">
        <!-- Шаг 1: Состав заказа -->
        <div *ngSwitchCase="0">
            <div class="basket-container" *ngIf="hasBasket; else noBasket">
                <tui-scrollbar waIntersectionRoot class="scrollbar" >
                    <div class="basket">
                        <div class="basket-header-row">
                            <!-- Чекбокс: Выбрать все -->
                            <tui-checkbox [ngModel]="checked" (ngModelChange)="onCheck($event)">
                            </tui-checkbox>
                            <div class="basket-title">Услуга</div>
                            <div class="basket-info">Стоимость</div>
                            <!-- Пустая ячейка под иконку удаления (для выравнивания) -->
                            <div class="select-actions">

                                <a href="#" mode="negative" tuiLink size="l" (click)="deleteSelected($event)"
                                    *ngIf="anySelected">
                                    Удалить выбранные
                                </a>
                            </div>
                        </div>
                        <tui-accordion [rounded]="false" [closeOthers]="false">
                            <tui-accordion-item *ngFor="let item of basketData" borders="top-bottom">
                                <div class="basket-header">
                                    <tui-checkbox [(ngModel)]="item.selected"
                                        (click)="onCheckboxClick($event, item)"></tui-checkbox>
                                    <div class="basket-title">{{ item.title }}</div>
                                    <div class="basket-info">
                                        <tui-money class="basket-price" [value]="item.cost"></tui-money>
                                    </div>
                                    <button appearance="secondary-destructive" icon="tuiIconTrash" shape="rounded"
                                        size="s" tuiIconButton type="button" [style.border-radius.%]="100"
                                        (click)="deleteService(item.uuid)">
                                    </button>
                                </div>
                                <ng-template tuiAccordionItemContent>
                                    <div class="basket-content">
                                        <!-- Левая колонка (Описание, Комментарий) -->
                                        <div class="basket-description">
                                          <div class="basket-description-block">
                                            <strong>Описание: </strong>
                                            <span>{{ item.description }}</span>
                                          </div>
                                          <div class="basket-description-block">
                                            <strong>Комментарий: </strong>
                                            <span>{{ item.comment || 'Не указано' }}</span>
                                          </div>
                                        </div>
                                    
                                        <!-- Средняя колонка (Параметры) -->
                                        <div class="basket-details">
                                          <div class="basket-params" *ngFor="let param of item.parameters">
                                            <strong>{{ param.title }}: </strong>
                                            <span>{{ param.values || 'Не указано' }}</span>
                                          </div>
                                        </div>
                                    
                                        <!-- Правая колонка (Файлы) -->
                                        <div class="basket-files" *ngIf="item.files && item.files.length > 0">
                                          <strong>Файлы</strong>
                                          <tui-files class="basket-file-list">
                                            <tui-file
                                              *ngFor="let fileName of item.files"
                                              state="normal"
                                              [file]="getFileLink(fileName)"
                                              [showDelete]="false"
                                            ></tui-file>
                                          </tui-files>
                                        </div>
                                      </div>
                                </ng-template>
                            </tui-accordion-item>
                        </tui-accordion>
                    </div>

                </tui-scrollbar>
                    <div class="total-amount">
                        Итого:
                        <tui-money class="basket-price" [value]="totalAmount"></tui-money>
                    </div>
                    <div class="button-container">
                        <button tuiButton size="m" style="width: 125px;" appearance="primary" (click)="nextStep()">
                            Далее
                        </button>
                    </div>
            </div>
            <ng-template #noBasket>
                <div class="tui-text_body-m" style="margin-top:2rem; text-align: center;">Ваша корзина пуста</div>
            </ng-template>
        </div>
        <!-- Шаг 2: Оформление заказа -->
        <div *ngSwitchCase="1">
            <h2>Оформление заказа</h2>
            <!-- Форма для оформления заказа -->
            <form #orderForm="ngForm">
                <!-- Добавьте необходимые поля формы -->
                <tui-input formControlName="address" label="Адрес доставки" placeholder="Введите адрес"></tui-input>
                <!-- Добавьте другие поля по необходимости -->
            </form>
            <button tuiButton (click)="prevStep()">Назад</button>
            <button tuiButton appearance="primary" (click)="placeOrder()">
                Оформить заказ
            </button>
        </div>

        <!-- Шаг 3: Подтверждение заказа -->
        <div *ngSwitchCase="2">
            <h2>Подтверждение заказа</h2>
            <p>Ваш заказ успешно оформлен!</p>
            <button tuiButton (click)="prevStep()">Назад</button>
        </div>
    </div>
</tui-root>