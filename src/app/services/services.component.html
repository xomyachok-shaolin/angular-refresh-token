<tui-root>
  <div class="custom-header">
    <div class="left-section">
      <img src="assets/LogoService.png" class="logo-img" />
    </div>
    <div class="right-section">
      <button size="m" tuiButton (click)="goBack()">Вернуться на портал</button>
    </div>
  </div>

  <!-- Main content area -->
  <div class="content">
    <div class="main-container">
      <div class="left-panel">
        <div class="map-container" style="position: relative">
          <!-- Leaflet map placeholder -->
          <div id="map" style="height: 100%; border-radius: 16px"></div>

          <!-- Loader positioned over the map -->
          <tui-loader
            [showLoader]="isLoading"
            size="xxl"
            [overlay]="true"
            class="map-loader"
          ></tui-loader>

          <!-- Filter Icon Button -->
          <button
            *ngIf="selectedService"
            class="filter-button"
            tuiIconButton
            appearance="flat"
            size="l"
            icon="tuiIconFilterLarge"
            (click)="toggleFilter()"
          ></button>

          <!-- Year Range Slider -->
          <div
            class="year-range-slider"
            *ngIf="showYearRangeSlider && selectedService"
          >
            <tui-input-range
              [formControl]="yearRangeControl"
              [min]="minYear"
              [max]="maxYear"
              [steps]="yearSteps"
              [quantum]="1"
              [tuiTextfieldSize]="'m'"
            >
              Выбор периода съемки
            </tui-input-range>
            <div class="year-labels">
              <span>{{ minYear }} год</span>
              <span>{{ maxYear }} год</span>
            </div>
          </div>
        </div>
      </div>

      <div class="right-panel">
        <tui-accordion>
          <!-- Service selection accordion item -->
          <tui-accordion-item [(open)]="openServiceAccordion">
            <div tuiAccordionItemTitle>Выбор услуги</div>
            <div tuiAccordionItemContent class="custom-accordion-content">
              <tui-combo-box
                tuiDropdownMobile
                [tuiTextfieldCleaner]="true"
                [(ngModel)]="selectedService"
                (ngModelChange)="onServiceChange($event)"
                (input)="filterServices($event)"
                [valueContent]="getServiceTitle(selectedService)"
                [stringify]="getServiceTitle"
                [disabled]="isLoading"
              >
                Услуга
                <tui-data-list-wrapper
                  *tuiDataList
                  [items]="filteredServices"
                  [itemContent]="serviceTemplate"
                ></tui-data-list-wrapper>
              </tui-combo-box>
            </div>
          </tui-accordion-item>

          <!-- Parameters selection accordion item -->
          <tui-accordion-item [(open)]="openParametersAccordion"
          (openChange)="onAccordionItemOpen(1)">
            <div tuiAccordionItemTitle>Выбор параметров</div>
            <div tuiAccordionItemContent class="custom-accordion-content">
              <button
                class="btn-draw"
                size="m"
                tuiButton
                *ngIf="!isDrawingEnabled"
                [disabled]="!selectedService"
                (click)="startDrawing()"
              >
                Нажмите для выбора территории
              </button>
              <button
                class="btn-draw"
                size="m"
                tuiButton
                *ngIf="isDrawingEnabled"
                [disabled]="isConfirmDisabled"
              >
                Для подтверждения нажмите Enter
              </button>
              <div>
                <p>Площадь выбранной территории: {{ formattedArea }} га</p>
              </div>

              <div>
                <tui-toggle
                  [(ngModel)]="heightEnabled"
                  size="l"
                  [showIcons]="true"
                >
                </tui-toggle>
                Высота
              </div>

              <div class="points-range">
                <label>Количество точек</label>
                <tui-input-range
                  [formControl]="control"
                  [max]="max"
                  [min]="min"
                  [quantum]="quantum"
                  [steps]="steps"
                  [tuiTextfieldLabelOutside]="true"
                  [tuiTextfieldSize]="'m'"
                ></tui-input-range>
              </div>
            </div>
          </tui-accordion-item>

          <!-- Calculation accordion item -->
          <tui-accordion-item [open]="openCalculationAccordion"
          (openChange)="onAccordionItemOpen(2)">
            <div tuiAccordionItemTitle>Расчет</div>
            <div tuiAccordionItemContent class="custom-accordion-content">
              Расчет
            </div>
          </tui-accordion-item>

          <!-- Checkout accordion item -->
          <tui-accordion-item
            [open]="openCheckoutAccordion"
            (openChange)="onAccordionItemOpen(3)"
          >
            <div tuiAccordionItemTitle>Оформление</div>
            <div tuiAccordionItemContent class="custom-accordion-content">
              Оформление
            </div>
          </tui-accordion-item>
        </tui-accordion>
      </div>
    </div>
  </div>

  <ng-template #serviceTemplate let-item>
    {{ item.title }}
  </ng-template>

  <ng-template #parameterTemplate let-item>
    {{ item.title }}
  </ng-template>
</tui-root>
